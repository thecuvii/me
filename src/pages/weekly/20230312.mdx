---
layout: ../../layouts/MarkdownPostLayout.astro
title: '周记 3月12日'
pubDate: 2023-03-12
author: 'AqingCyan'
tags: ['weekly']
description: '匆忙的、计划混乱的、着急的一周'
image: 'https://sm.ms/image/Dt34FYBgkGinb9o'
---

## 生活里

本周太忙了，倒没怎么忙自己的事情。

### 读书

一直在读刘震云写的《一句顶一万句》，时间跨度很大的小说，分为《出延津记》和 《回延津记》，主要就表达了人跟人说话能说得着就不容易，很多事说着说着就变成另一件事，因为一个说得着与说不着，很多人与事就发生了变化，故事也因此推动下去。

但我读的很慢，大概一天读上五六页，现在还剩三十多页的样子，大概下周就读完了。

### 娱乐

上周玩的 《咩咩启示录》 在这周开始的时候还玩了一下，已经把教会发展到有活人献祭了。有 8 个教徒，以及正常老去了 3 个教徒。但后面就忙活工作的事情，真的力不从心。

这周由于发了奖金，终于舍得把心心念念的镜头买回家了。但是为什么年后价格涨了 2000 块钱啊！我疯了！不过年前买的相机也涨价了，这么一下抵消了我没占到便宜的失落感。

<blockquote class="twitter-tweet">
  <p lang="zh" dir="ltr">
    人生第一颗G大师。 <a href="https://t.co/PbEFLWH7Wk">pic.twitter.com/PbEFLWH7Wk</a>
  </p>
  &mdash; Paracetamol (@purexitong0101) <a href="https://twitter.com/purexitong0101/status/1633485298784178178?ref_src=twsrc%5Etfw">March 8, 2023</a>
</blockquote>

但本周的工作忙碌，导致我没有时间去拍摄，只能等下周了。

### 电影

其实我觉得 《蚁人 3》还行，虽然剧情一般般，特效见惯不惯的，但是我就像娱乐放松一下，不带脑子就好。

### 其他

已经开始用上了 Chat-GPT 加 Github Copilot 的组合，但是 AI 总是有一些自以为是的行为，例如我写这篇时

![image.png](https://s2.loli.net/2023/03/13/jUTRYkLap5bIAwi.png)

<sup>_为什么会觉得我在玩原神？_</sup>

以及我让 Chat-GPT 给我一下 《一句顶一万句》 的一些介绍

![image.png](https://s2.loli.net/2023/03/13/J4PMOVZtKrclfhq.png)

<sup>_胡说八道的本领真的很强，以及这只是我本周遇到冰山一角_</sup>

## 工作相关

本周在公司里的计划排期完全是乱掉的，本来应该开始的任务迟迟被耽搁，反而在收尾前面的事情。

### 收尾的项目

我们因为业务要拆分得更加细致，需要考虑给新的业务构建整个商品售卖服务流程。为了更快速度更低成本的搞定这件事，最后决定是基于原有的项目以 COPY 为大前提进行拆分。

本周就是要完成这个工作的上线，但上线就发现很多事情卡点，比如说：域名还没有完成公网备案；支付域名接入；突入其来的在预发环境产生的 bug；临时加进来的需求导致我两头顾不过来。

直到本周四才完成了整体的上线，但周四晚上又出来了一个 bug 。这个 bug 本身还蛮好改的，就是做拆分的时候少抽离了一个配置，将其抽离后，CI 运行打包一直产生错误。最后花了三个小时（中间也是被别的事情耽搁）才搞定。

原因很简单但不常见，就是项目脚手架的定义的全局变量只能在前端被读取到。而我在读取配置的时候就试图通过一个全局变量将具体配置从对象中抽离出来，这在编译打包的时候（纯 node 环境），就会报错。而原先项目这么做没问题，是因为原来的项目在读取这个配置的时候有额外 `if else` 逻辑导致编译打包的时候不进行变量读取，而是将整个配置对象和读取它的全局变量名都打包进代码中，在前端执行到其中的逻辑时才会读取变量（此时已是前端环境）。而我改的 bug 也是一处配置的读取，它是直接通过这个全局变量读取配置对象中的值来拼接一个跳转地址的。所以打包编译的时候，脚手架为了优化就尝试直接读取出这个值，但此时拿不到全局变量，就打包失败了。

### 富文本的标签处理

接了一个临时需求，要求把富文本产出的 html 字符串中的下划线样式做处理，本质原因是系统的富文本实现下划线效果是依靠 `<span style="text-decoration: underline" >xxxx</span>` 实现的，而在我们的客户端机器上渲染存在问题。考虑此，打算用 `<u />` 来替换下划线样式的 span 标签。

一开始的想法是使用正则，用正则匹配后进行反引用替换。但真实编辑状态下富文本产出的内容各式各样的，标签互相嵌套。我没办法写出一个完美的正则去匹配下划线样式的 span 标签。

后来，问了一下 Chat-GPT ，它给出了我这样一个思路，将 html 字符串转换为 DOM 对象，查询符合条件的 span 标签，进行替换，再转为字符串就好了。思路很好，代码呼之欲出：

```ts
function replaceUnderlineSpan(htmlString: string): string {
  // 将 HTML 字符串解析为 DOM 对象
  const parser = new DOMParser()
  const doc = parser.parseFromString(htmlString, 'text/html')

  // 获取所有样式为下划线的 span 标签
  const underlineSpans = doc.querySelectorAll('span[style="text-decoration: underline;"]')

  // 遍历每个 span 标签，将其替换为 u 标签
  underlineSpans.forEach((span) => {
    const u = doc.createElement('u')
    u.innerHTML = span.innerHTML
    span.replaceWith(u)
  })

  // 将 DOM 对象序列化为 HTML 字符串并返回
  return doc.documentElement.innerHTML
}
```

### 未开启的工作

我这周是有一个于周二要开始开发的工作的，原定周五联调。但因为前面的事情一拖再拖，导致这个工作也被耽搁了。

好在和我联调的同事也因为类似的事情耽搁，于是定在下周一联调。于是周末我们两很不期而遇在线上相遇了。😌 （但不提倡周末加班，真的不提倡！）

一直写到半夜里，但很多东西我看东拉西扯，下一周也许要费劲儿对很多东西。

希望下周能安稳一些，井井有条的把工作做就绪，然后有时间拍拍照，玩玩游戏，看看电影，聊聊天。
