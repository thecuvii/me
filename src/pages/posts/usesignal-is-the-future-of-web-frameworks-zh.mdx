---
layout: ../../layouts/MarkdownPostLayout.astro
title: 'useSignal() æ˜¯ Web æ¡†æ¶çš„æœªæ¥'
pubDate: 2023-02-28
description: '[ç¿»è¯‘] Signals æ˜¯ä¸€ç§å­˜å‚¨åº”ç”¨ç¨‹åºçŠ¶æ€çš„æ–¹å¼ï¼Œç±»ä¼¼äº React ä¸­çš„ useState()ã€‚ä½†æœ‰ä¸€äº›å…³é”®å·®å¼‚ä½¿ Signals æ›´å…·ä¼˜åŠ¿ã€‚'
author: 'WRITTEN BY MIÅ KO HEVERY'
tags: ['translate', 'signal']
image: 'https://s2.loli.net/2023/02/28/g6xr8W1aotyjfFL.png'
---

> æœ¬æ–‡ä¸ºä¸€ç¯‡ç¿»è¯‘ï¼Œä½ å¯ä»¥ç‚¹æ­¤è®¿é—®åŸæ–‡ï¼š[useSignal() is the Future of Web Frameworks](https://www.builder.io/blog/usesignal-is-the-future-of-web-frameworks)

![image.png](https://s2.loli.net/2023/02/28/g6xr8W1aotyjfFL.png)

Signals æ˜¯ä¸€ç§å­˜å‚¨åº”ç”¨ç¨‹åºçŠ¶æ€çš„æ–¹å¼ï¼Œç±»ä¼¼äº React çš„ `useState()`ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€äº›å…³é”®çš„å·®å¼‚ä½¿ Signals æ›´å…·ä¼˜åŠ¿ã€‚

## ä»€ä¹ˆæ˜¯ä¿¡å·

```ts
useState() => value + setter
useSignals() => getter + setter
```

Signals å’Œ State ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äº Signals è¿”å›ä¸€ä¸ª getter å’Œä¸€ä¸ª setterï¼Œè€Œéå“åº”å¼ç³»ç»Ÿè¿”å›å€¼ï¼ˆå’Œä¸€ä¸ª setterï¼‰ã€‚_æ³¨æ„: æœ‰äº›ååº”å¼ç³»ç»Ÿä¸€èµ·è¿”å› getter/setterï¼Œæœ‰äº›åˆ™ä½œä¸ºä¸¤ä¸ªç‹¬ç«‹çš„å¼•ç”¨ï¼Œä½†å…¶æ€æƒ³æ˜¯ç›¸åŒçš„ã€‚_

### State vs. State

é—®é¢˜æ˜¯ _State_ è¿™ä¸ªå•è¯æ··æ·†äº†ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚

- **StateReference**ï¼š _reference_ æ˜¯æŒ‡çŠ¶æ€çš„å¼•ç”¨ï¼ˆè¯‘è€…æ³¨ï¼šæˆ‘ç†è§£æ˜¯ _state_ çš„æŒ‡é’ˆï¼‰ã€‚
- **StateValue**ï¼šè¿™æ˜¯å­˜æ”¾åœ¨åœ¨çŠ¶æ€å¼•ç”¨ æˆ– å­˜å‚¨ä¸­çš„å®é™…çš„ _value_ã€‚

ä¸ºä»€ä¹ˆè¿”å› getter æ¯”è¿”å›å…¶å€¼è¦æœ‰ä¼˜åŠ¿ï¼Ÿå› ä¸ºé€šè¿‡è¿”å› getterï¼Œä½ å¯ä»¥å°†**çŠ¶æ€å¼•ç”¨**çš„ä¼ é€’ä¸**çŠ¶æ€å€¼**çš„è¯»å–åˆ†ç¦»å¼€æ¥ã€‚

è®©æˆ‘ä»¬ä»¥ä¸€æ®µ SolidJS ä»£ç ä¸ºä¾‹ï¼š

```tsx
export function Counter() {
  const [getCount, setCount] = createSignal(0)

  return <button onClick={() => setCount(getCount() + 1)}>{getCount()}</button>
}
```

- `createSignal()`ï¼šåˆ†é… `StateStorage` å¹¶å°†å…¶åˆå§‹åŒ–ä¸º `0`ã€‚
- `getCount`ï¼šstore çš„å¼•ç”¨ï¼Œä½ å¯ä»¥ä¼ é€’å®ƒã€‚
- `getCount()`ï¼šæ˜¯ä½ é€šè¿‡å¼•ç”¨è·å–åˆ°çš„çŠ¶æ€ä¸­çš„å€¼ã€‚

## æˆ‘æ²¡æ‡‚ï¼æˆ‘çœ‹èµ·æ¥è§‰å¾—ä¸€æ ·å•Š

ä¸Šé¢è§£é‡Šäº† _Signals_ ä¸æ—§çš„ _State_ çš„ä¸åŒï¼Œä½†æ²¡æœ‰è§£é‡Šä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥å…³æ³¨è¿™ä¸€å·®å¼‚ã€‚

Signals è‹¥æ˜¯å¯å“åº”çš„ï¼å°±æ„å‘³ç€å®ƒä»¬ä¼šè¿½è¸ªå¯¹çŠ¶æ€æ„Ÿå…´è¶£çš„ï¼ˆè®¢é˜…ï¼‰äººï¼Œå¦‚æœçŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œå°±é€šçŸ¥è®¢é˜…è€…çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ã€‚

è¦å…·æœ‰å“åº”æ€§ï¼ŒSignals å¿…é¡»æ”¶é›†è°å¯¹ Signals çš„å€¼æ„Ÿå…´è¶£ï¼ˆè®¢é˜…ï¼‰ã€‚ä»–ä»¬é€šè¿‡è§‚å¯Ÿåœ¨å“ªäº›ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ _state-getter_ æ¥è·å¾—è¿™äº›ä¿¡æ¯ã€‚é€šè¿‡ä» getter è·å–å€¼çš„è¡Œä¸ºï¼Œå¯ä»¥å‘Šè¯‰ Signals è¿™ä¸ªåœ°æ–¹å¯¹å…¶å€¼æ„Ÿå…´è¶£ã€‚å¦‚æœå€¼å‘ç”Ÿæ›´æ”¹ï¼Œåˆ™éœ€è¦ä½¿è¯¥ä½ç½®å‘ç”Ÿé‡æ–°è®¡ç®—ã€‚æ¢å¥è¯è¯´ï¼Œè°ƒç”¨ _getter_ å°†åˆ›å»ºè®¢é˜…ã€‚

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä¼ é€’ _state-getter_ è€Œä¸æ˜¯ _state-value_ éå¸¸é‡è¦çš„åŸå› ã€‚çŠ¶æ€å€¼çš„ä¼ é€’ä¸ä¼šå‘ Signals æä¾›å…³äºå®é™…ä½¿ç”¨è¯¥å€¼çš„åœ°æ–¹çš„ä»»ä½•ä¿¡æ¯ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåŒºåˆ†çŠ¶æ€ **reference** å’ŒçŠ¶æ€ **value** åœ¨ Signals ä¸­å¦‚æ­¤é‡è¦ã€‚

ç›¸æ¯”ä¹‹ä¸‹ï¼Œ[Qwik](https://qwik.builder.io/) ä¹Ÿæœ‰åŒæ ·çš„ä¾‹å­ã€‚æ³¨æ„ï¼ï¼ˆgetter/setterï¼‰å·²è¢«æ›¿æ¢ä¸ºå•ä¸ªå¯¹è±¡çš„ `.value` å±æ€§ï¼ˆå…¶å®å°±æ˜¯ getter/setterï¼‰ã€‚è™½ç„¶è¯­æ³•ä¸åŒï¼Œä½†å†…éƒ¨å·¥ä½œåŸç†æ˜¯ç›¸åŒçš„ã€‚

```tsx
export function Counter() {
  const count = useSignal(0)

  return <button onClick$={() => count.value++}>{count.value}</button>
}
```

é‡è¦çš„æ˜¯ï¼Œå½“å•å‡»æŒ‰é’®å¹¶ç´¯åŠ å€¼æ—¶ï¼Œæ¡†æ¶åªéœ€è¦å°†æ–‡æœ¬èŠ‚ç‚¹ä»`0`æ›´æ–°åˆ°`1`ã€‚ä¹‹æ‰€ä»¥å¯ä»¥è¿™æ ·åšï¼Œæ˜¯å› ä¸ºåœ¨æ¨¡æ¿çš„åˆå§‹åŒ–æ¸²æŸ“æœŸé—´ï¼ŒSignal å·²ç»äº†è§£åˆ°åªæœ‰æ–‡æœ¬èŠ‚ç‚¹æ‰èƒ½è®¿é—® `count.value` ã€‚å› æ­¤ï¼Œå®ƒçŸ¥é“å¦‚æœ `count` çš„å€¼å‘ç”Ÿå˜åŒ–ï¼Œå®ƒåªéœ€è¦æ›´æ–°æ–‡æœ¬èŠ‚ç‚¹ï¼Œè€Œä¸éœ€è¦æ›´æ–°å…¶ä»–å†…å®¹ã€‚

## `useState()` çš„ç¼ºç‚¹

ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹ React æ˜¯å¦‚ä½•ä½¿ç”¨ `useState()` çš„ï¼Œå¹¶çœ‹çœ‹å®ƒçš„ç¼ºç‚¹ï¼š

```tsx
export function Counter() {
  const [count, setCount] = useState(0)

  return <button onClick={() => setCount(count + 1)}>{count}</button>
}
```

React çš„ `useState()` è¿”å›çš„æ˜¯ _state-value_ ã€‚è¿™æ„å‘³ç€ `useState()` ä¸çŸ¥é“ _state-value_ åœ¨ç»„ä»¶æˆ–åº”ç”¨ç¨‹åºä¸­è¢«å¦‚ä½•ä½¿ç”¨ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼šä¸€æ—¦ä½ é€šè¿‡ `setState()` é€šçŸ¥ React è¿›è¡ŒçŠ¶æ€æ›´æ”¹ï¼ŒReact å¹¶ä¸çŸ¥é“é¡µé¢çš„å“ªä¸ªéƒ¨åˆ†å·²ç»æ›´æ”¹ï¼Œå› æ­¤å¿…é¡»é‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶ã€‚è¿™æ˜¯ä¸€ç§æ˜‚è´µçš„è®¡ç®—æ¶ˆè€—ã€‚

## `useRef()` ä¸è¿›è¡Œæ¸²æŸ“

`useRef()` çš„ä½¿ç”¨æ–¹å¼å’Œ `useSignal()` å¾ˆåƒï¼Œç”¨äºä¼ é€’å¯¹çŠ¶æ€çš„å¼•ç”¨ï¼ˆ_reference_ï¼‰ï¼Œè€ŒéçŠ¶æ€æœ¬èº«ã€‚å¯ `useRef()` ç¼ºå°‘çš„æ˜¯è®¢é˜…è¿½è¸ªä¸é€šçŸ¥ã€‚

å¹¸å¥½ï¼Œåœ¨åŸºäº Signals çš„æ¡†æ¶ä¸­ï¼Œ`usessignal()` å’Œ `useRef()` æ˜¯ç›¸åŒçš„ä¸œè¥¿ã€‚`useSignal()` ä¸ä»…å¯ä»¥å®Œæˆ `useRef()` æ‰€åšçš„å·¥ä½œï¼Œè¿˜å¯ä»¥è¿›è¡Œè®¢é˜…è¿½è¸ªã€‚è¿™è¿›ä¸€æ­¥ç®€åŒ–äº†æ¡†æ¶çš„ API è®¾è®¡ã€‚

## `useMemo()` æ˜¯å†…ç½®çš„

Signals å¾ˆå°‘æœ‰éœ€è¦ä½¿ç”¨ç¼“å­˜çš„æƒ…å†µï¼Œå› ä¸ºå®ƒå¼€ç®±å³ç”¨ï¼Œå¯¹æ­¤æ²¡æœ‰ä»€ä¹ˆå·¥ä½œé‡ï¼

è¯·æ€è€ƒè¿™ä¸¤ä¸ªè®¡æ•°å™¨å’Œå…¶ä¸¤ä¸ªå­—ç»„ä»¶çš„ç¤ºä¾‹ï¼š

```tsx
export function Counter() {
  console.log('<Counter />')
  const countA = useSignal(0)
  const countB = useSignal(0)

  return (
    <div>
      <button onClick$={() => countA.value++}>A</button>
      <button onClick$={() => countB.value++}>B</button>
      <Display count={countA.value} />
      <Display count={countB.value} />
    </div>
  )
}

export const Display = component$(({ count }: { count: number }) => {
  console.log(`<Display count={${count}} />`)
  return <div>{count}!</div>
})
```

åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œåªæœ‰ä¸¤ä¸ª `Display` ç»„ä»¶ä¸­çš„ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ä¼šè¢«æ›´æ–°ã€‚æ²¡æœ‰å¾—åˆ°æ›´æ–°çš„æ–‡æœ¬èŠ‚ç‚¹åœ¨é¦–æ¬¡æ¸²æŸ“åå°†æ°¸è¿œä¸ä¼šæ‰“å°ã€‚

```shell
# Initial render output
<Counter/>
<Display count={0}/>
<Display count={0}/>

# Subsequent render on click
(blank...)
```

è€Œä½ å®Œå…¨æ— æ³•é€šè¿‡ React å®ç°åŒæ ·çš„æ•ˆæœï¼Œå› ä¸ºè‡³å°‘ä¼šæœ‰ä¸€ä¸ªç»„ä»¶éœ€è¦é‡æ–°æ¸²æŸ“ã€‚æ‰€ä»¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨ React ä¸­ç¼“å­˜ç»„ä»¶ä»¥åšåˆ°æœ€å°‘æ¬¡çš„é‡æ¸²æŸ“ã€‚

```tsx
export default function Counter() {
  console.log('<Counter />')
  const [countA, setCountA] = useState(0)
  const [countB, setCountB] = useState(0)

  return (
    <div>
      <button onClick={() => setCountA(countA + 1)}>A</button>
      <button onClick={() => setCountB(countB + 1)}>B</button>
      <Display count={countA} />
      <Display count={countB} />
    </div>
  )
}

export const MemoDisplay = memo(Display)

export function Display({ count }: { count: number }) {
  console.log(`<Display count={${count}} />`)
  return <div>{count}!</div>
}
```

ä½†å°±ç®—æ˜¯ä½¿ç”¨äº†ç¼“å­˜çš„æ–¹å¼ï¼ŒReact è¿˜æ˜¯ä¼šæ‰§è¡Œå¤šæ¬¡é‡æ¸²æŸ“ï¼š

```shell
# Initial render output
<Counter/>
<Display count={0}/>
<Display count={0}/>

# Subsequent render on click
<Counter/>
<Display count={1}/>
```

å¦‚æœæˆ‘ä»¬æ²¡æœ‰ç”¨ `memo` æ¥å¤„ç†ï¼Œé‚£æˆ‘ä»¬å¯ä»¥çœ‹åˆ° logï¼š

```shell
# Initial render output
<Counter/>
<Display count={0}/>
<Display count={0}/>

# Subsequent render on click
<Counter/>
<Display count={1}/>
<Display count={0}/>
```

è¿™å°±æ¯”ä½¿ç”¨ Signals è¦åšçš„å·¥ä½œå¤šå¾—å¤šã€‚æ‰€ä»¥ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ Signals çš„ä½œç”¨å°±å¥½åƒä½ è®°ä½äº†æ‰€æœ‰ä¸œè¥¿ï¼Œè€Œå®é™…ä¸Šä½ è‡ªå·±ä¸éœ€è¦è®°ä½ä»»ä½•ä¸œè¥¿ã€‚

## Props é€ä¼ 

è®©æˆ‘ä»¬çœ‹ä¸€ä¸ª React çš„è´­ç‰©è½¦ç¤ºä¾‹ï¼š

> è¿˜åœ¨è¿›è¡Œä¸­ ğŸ˜­
